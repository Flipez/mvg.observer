import{r as u,j as e}from"./jsx-runtime-kF-aRxYe.js";import{l as H,m as D,P as C,n as rt,d as P,u as ye,c as Se,e as _,y as De,B as I,r as nt,p as st}from"./index-5hEqvTZa.js";import{a0 as at,$ as ot,a2 as lt,Y as ct,a3 as it,u as ke,C as dt,a as ut,Z as z,a4 as fe,c as Ne,a5 as ht}from"./subway-lines-DSTUkkPE.js";import{t as V,i as ft}from"./i18next-B7RnYmCb.js";import{t as mt,m as xt,f as T,C as F,c as K,d as O,e as U,h as me,P as pt,a as bt,b as jt,S as xe,l as gt,n as vt,s as J}from"./subway-label-C4BBXhYZ.js";import{D as se,a as ae,b as oe,g as le,c as wt,d as yt,f as ce,X as St}from"./dropdown-menu-6REHcO_C.js";import{T as y,S as Dt,b as kt,c as Nt,e as pe,g as be}from"./tabs-BPEWxzeZ.js";import{q as Tt}from"./index-DP6bXXZD.js";import{u as Ct}from"./chevron-right-D14rKM1j.js";import"./index-DgWtcivP.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=H("ArrowDownFromLine",[["path",{d:"M19 3H5",key:"1236rx"}],["path",{d:"M12 21V7",key:"gj6g52"}],["path",{d:"m6 15 6 6 6-6",key:"h15q88"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=H("ArrowUpFromLine",[["path",{d:"m18 9-6-6-6 6",key:"kcunyi"}],["path",{d:"M12 3v14",key:"7cf3v8"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=H("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=H("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=H("TramFront",[["rect",{width:"16",height:"16",x:"4",y:"3",rx:"2",key:"1wxw4b"}],["path",{d:"M4 11h16",key:"mpoxn0"}],["path",{d:"M12 3v8",key:"1h2ygw"}],["path",{d:"m8 19-2 3",key:"13i0xs"}],["path",{d:"m18 22-2-3",key:"1p0ohu"}],["path",{d:"M8 15h.01",key:"a7atzg"}],["path",{d:"M16 15h.01",key:"rnfrdf"}]]);function Q(t,r,n){const s=mt(t,n==null?void 0:n.in);return s.setTime(s.getTime()+r*xt),s}const _t={light:"",dark:".dark"},Te=u.createContext(null);function Ce(){const t=u.useContext(Te);if(!t)throw new Error("useChart must be used within a <ChartContainer />");return t}const Pe=u.forwardRef(({id:t,className:r,children:n,config:s,...a},l)=>{const o=u.useId(),c=`chart-${t||o.replace(/:/g,"")}`;return e.jsx(Te.Provider,{value:{config:s},children:e.jsxs("div",{"data-chart":c,ref:l,className:D("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",r),...a,children:[e.jsx(Et,{id:c,config:s}),e.jsx(ot,{children:n})]})})});Pe.displayName="Chart";const Et=({id:t,config:r})=>{const n=Object.entries(r).filter(([,s])=>s.theme||s.color);return n.length?e.jsx("style",{dangerouslySetInnerHTML:{__html:Object.entries(_t).map(([s,a])=>`
${a} [data-chart=${t}] {
${n.map(([l,o])=>{var h;const c=((h=o.theme)==null?void 0:h[s])||o.color;return c?`  --color-${l}: ${c};`:null}).join(`
`)}
}
`).join(`
`)}}):null},At=at,It=u.forwardRef(({active:t,payload:r,className:n,indicator:s="dot",hideLabel:a=!1,hideIndicator:l=!1,label:o,labelFormatter:c,labelClassName:h,formatter:i,color:b,nameKey:d,labelKey:x},j)=>{const{config:m}=Ce(),p=u.useMemo(()=>{var N;if(a||!(r!=null&&r.length))return null;const[f]=r,k=`${x||f.dataKey||f.name||"value"}`,w=ee(m,f,k),v=!x&&typeof o=="string"?((N=m[o])==null?void 0:N.label)||o:w==null?void 0:w.label;return c?e.jsx("div",{className:D("font-medium",h),children:c(v,r)}):v?e.jsx("div",{className:D("font-medium",h),children:v}):null},[o,c,r,a,h,m,x]);if(!t||!(r!=null&&r.length))return null;const g=r.length===1&&s!=="dot";return e.jsxs("div",{ref:j,className:D("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",n),children:[g?null:p,e.jsx("div",{className:"grid gap-1.5",children:r.map((f,k)=>{const w=`${d||f.name||f.dataKey||"value"}`,v=ee(m,f,w),N=b||f.payload.fill||f.color;return e.jsx("div",{className:D("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",s==="dot"&&"items-center"),children:i&&(f==null?void 0:f.value)!==void 0&&f.name?i(f.value,f.name,f,k,f.payload):e.jsxs(e.Fragment,{children:[v!=null&&v.icon?e.jsx(v.icon,{}):!l&&e.jsx("div",{className:D("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":s==="dot","w-1":s==="line","w-0 border-[1.5px] border-dashed bg-transparent":s==="dashed","my-0.5":g&&s==="dashed"}),style:{"--color-bg":N,"--color-border":N}}),e.jsxs("div",{className:D("flex flex-1 justify-between leading-none",g?"items-end":"items-center"),children:[e.jsxs("div",{className:"grid gap-1.5",children:[g?p:null,e.jsx("span",{className:"text-muted-foreground",children:(v==null?void 0:v.label)||f.name})]}),f.value&&e.jsx("span",{className:"font-mono font-medium tabular-nums text-foreground",children:f.value.toLocaleString()})]})]})},f.dataKey)})})]})});It.displayName="ChartTooltip";const Bt=u.forwardRef(({className:t,hideIcon:r=!1,payload:n,verticalAlign:s="bottom",nameKey:a},l)=>{const{config:o}=Ce();return n!=null&&n.length?e.jsx("div",{ref:l,className:D("flex items-center justify-center gap-4",s==="top"?"pb-3":"pt-3",t),children:n.map(c=>{const h=`${a||c.dataKey||"value"}`,i=ee(o,c,h);return e.jsxs("div",{className:D("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[i!=null&&i.icon&&!r?e.jsx(i.icon,{}):e.jsx("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:c.color}}),i==null?void 0:i.label]},c.value)})}):null});Bt.displayName="ChartLegend";function ee(t,r,n){if(typeof r!="object"||r===null)return;const s="payload"in r&&typeof r.payload=="object"&&r.payload!==null?r.payload:void 0;let a=n;return n in r&&typeof r[n]=="string"?a=r[n]:s&&n in s&&typeof s[n]=="string"&&(a=s[n]),a in t?t[a]:t[n]}const Lt={desktop:{label:"Desktop",color:"hsl(var(--chart-1))"}};function $t(t,r,n){const s=[],a=n*60*1e3;for(let l=t;l<=r;l+=a)s.push(l);return s}function Ht(t,r,n,s){const a=$t(r,n,s),l={};return t.forEach(o=>{const c=new Date(o.bucket.replace(" ","T")).getTime();l[c]=o}),a.map(o=>l[o]?{...l[o],bucket:o}:{bucket:o,avgDelay:null,numDepartures:null})}const Vt=({active:t,elements:r,showPercentage:n,threshold:s})=>{if(!t||!(r!=null&&r.length)||!r[0].payload)return null;const{bucket:a,numDepartures:l}=r[0].payload,o=Number(r[0].value).toFixed(2),c=n?V("Table.Tooltip.PercDelay"):V("Table.Tooltip.AvgDelay"),h=n?`% (> ${s} min)`:"min",i=ft.language==="de"?T(a,"HH:mm")+" Uhr":T(a,"hh:mm aaa");return e.jsxs("div",{style:{position:"relative",zIndex:9999},className:"rounded border bg-white p-2 shadow",children:[e.jsx("p",{className:"text-sm",children:`${V("Table.Tooltip.Time")}: ${i}`}),e.jsx("p",{className:"text-sm",children:`${V("Table.Tooltip.Departures")}: ${l}`}),e.jsx("p",{className:"text-sm",children:`${c}: ${o} ${h}`})]})};function ve({stationData:t,day:r,interval:n,yAxisOrientation:s,showPercentage:a,threshold:l}){const o=new Date(`${r}T00:00:00`).getTime(),c=new Date(`${r}T00:00:00`);c.setDate(c.getDate()+1);const h=c.getTime(),i=n,b=Ht(t.buckets,o,h,i);return e.jsx(Pe,{className:"h-[35px] w-full",config:Lt,children:e.jsxs(lt,{accessibilityLayer:!0,data:b,barGap:0,barCategoryGap:.5,margin:{left:0,right:0,top:0,bottom:0},children:[e.jsx(ct,{domain:[0,a?100:10],orientation:s}),e.jsx(At,{cursor:!1,content:d=>e.jsx(Vt,{active:d.active,elements:d.payload,showPercentage:a,threshold:l}),wrapperStyle:{zIndex:9999}}),e.jsx(it,{isAnimationActive:!1,dataKey:a?"percentageThreshold":"avgDelay",type:"step",fill:"#5063DF",fillOpacity:.9,shape:d=>e.jsx(Ft,{...d,chartHeight:35})})]})})}const Ft=({x:t,y:r,width:n,height:s,value:a,chartHeight:l})=>{if(a==null)return null;const o=0,c=s===0?o:s,h=s===0?r-o:r;return e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:t,y:0,width:n,height:l,fill:"#eee"}),e.jsx("rect",{x:t,y:h,width:n,height:c,fill:"#5063DF"})]})};var Kt="Label",Me=u.forwardRef((t,r)=>e.jsx(C.label,{...t,ref:r,onMouseDown:n=>{var a;n.target.closest("button, input, select, textarea")||((a=t.onMouseDown)==null||a.call(t,n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));Me.displayName=Kt;var Re=Me;const Ot=rt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Y=u.forwardRef(({className:t,...r},n)=>e.jsx(Re,{ref:n,className:D(Ot(),t),...r}));Y.displayName=Re.displayName;var G="Switch",[Ut,Br]=Se(G),[zt,Yt]=Ut(G),_e=u.forwardRef((t,r)=>{const{__scopeSwitch:n,name:s,checked:a,defaultChecked:l,required:o,disabled:c,value:h="on",onCheckedChange:i,form:b,...d}=t,[x,j]=u.useState(null),m=P(r,w=>j(w)),p=u.useRef(!1),g=x?b||!!x.closest("form"):!0,[f,k]=ye({prop:a,defaultProp:l??!1,onChange:i,caller:G});return e.jsxs(zt,{scope:n,checked:f,disabled:c,children:[e.jsx(C.button,{type:"button",role:"switch","aria-checked":f,"aria-required":o,"data-state":Be(f),"data-disabled":c?"":void 0,disabled:c,value:h,...d,ref:m,onClick:_(t.onClick,w=>{k(v=>!v),g&&(p.current=w.isPropagationStopped(),p.current||w.stopPropagation())})}),g&&e.jsx(Ie,{control:x,bubbles:!p.current,name:s,value:h,checked:f,required:o,disabled:c,form:b,style:{transform:"translateX(-100%)"}})]})});_e.displayName=G;var Ee="SwitchThumb",Ae=u.forwardRef((t,r)=>{const{__scopeSwitch:n,...s}=t,a=Yt(Ee,n);return e.jsx(C.span,{"data-state":Be(a.checked),"data-disabled":a.disabled?"":void 0,...s,ref:r})});Ae.displayName=Ee;var Gt="SwitchBubbleInput",Ie=u.forwardRef(({__scopeSwitch:t,control:r,checked:n,bubbles:s=!0,...a},l)=>{const o=u.useRef(null),c=P(o,l),h=ke(n),i=De(r);return u.useEffect(()=>{const b=o.current;if(!b)return;const d=window.HTMLInputElement.prototype,j=Object.getOwnPropertyDescriptor(d,"checked").set;if(h!==n&&j){const m=new Event("click",{bubbles:s});j.call(b,n),b.dispatchEvent(m)}},[h,n,s]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...a,tabIndex:-1,ref:c,style:{...a.style,...i,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ie.displayName=Gt;function Be(t){return t?"checked":"unchecked"}var Le=_e,qt=Ae;const ie=u.forwardRef(({className:t,...r},n)=>e.jsx(Le,{className:D("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...r,ref:n,children:e.jsx(qt,{className:D("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));ie.displayName=Le.displayName;function Xt({settings:t,setSettings:r}){const n=()=>{r(a=>({...a,chartDate:fe(a.chartDate,1)}))},s=()=>{r(a=>({...a,chartDate:fe(a.chartDate,-1)}))};return e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(Y,{htmlFor:"datepicker",className:"text-sm font-medium",children:e.jsx(y,{children:"PITA.Subject.Date"})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"mr-2 hidden xl:inline-flex",variant:"outline",onClick:s,children:e.jsx(Pt,{className:""})}),e.jsxs(pt,{children:[e.jsx(bt,{asChild:!0,children:e.jsxs(I,{id:"datepicker",variant:"outline",className:D("w-full justify-start text-left font-normal"),children:[e.jsx(dt,{}),T(t.chartDate,"EEEE, MMM do yyyy")]})}),e.jsx(jt,{className:"w-auto p-0",children:e.jsx(ut,{mode:"single",hidden:[{before:new Date(2024,1,17)}],selected:t.chartDate,onSelect:a=>r(l=>({...l,chartDate:a}))})})]}),e.jsx(I,{className:"ml-2 hidden xl:inline-flex",variant:"outline",onClick:n,children:e.jsx(Mt,{className:"h-4"})})]})]})}function Wt({settings:t,setSettings:r}){return e.jsx("div",{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{checked:t.realtime,onCheckedChange:n=>r(s=>({...s,realtime:n}))}),e.jsx("span",{children:e.jsx(y,{children:"PITA.Realtime.Switch"})})]})})}function Zt({settings:t,setSettings:r}){return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{disabled:t.selectedTab==="map",checked:t.showPercentage,onCheckedChange:n=>r(s=>({...s,showPercentage:n}))}),e.jsx("span",{children:e.jsx(y,{children:"PITA.Percentage.Switch"})})]})}function Jt({settings:t,setSettings:r}){const n=[{value:5,label:"5 Minutes"},{value:10,label:"10 Minutes"},{value:20,label:"20 Minutes"},{value:60,label:"60 Minutes"}];return e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(Y,{htmlFor:"intervalpicker",className:"text-sm font-medium",children:e.jsx(y,{children:"PITA.Subject.Interval"})}),e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs(I,{id:"intervalpicker",variant:"outline",children:[t.interval," ",e.jsx(y,{children:"Misc.Minutes"})]})}),e.jsxs(oe,{children:[e.jsx(le,{}),n.map(s=>e.jsx(ce,{onSelect:()=>r(a=>({...a,interval:s.value})),children:s.label},s.value))]})]})]})}function Qt({settings:t,setSettings:r}){const n=[{value:0,label:"0 Minutes"},{value:1,label:"1 Minute"},{value:2,label:"2 Minutes"},{value:3,label:"3 Minutes"},{value:4,label:"4 Minutes"},{value:5,label:"5 Minutes"},{value:10,label:"10 Minutes"},{value:15,label:"15 Minutes"}],s=a=>{const l=n.find(o=>o.value===a);return l?l.label:`${a} Minutes`};return e.jsx("div",{children:e.jsxs(se,{children:[e.jsx(ae,{disabled:!t.showPercentage||t.selectedTab==="map",children:e.jsx(I,{className:"w-full",variant:"outline",id:"thresholdpicker",disabled:!t.showPercentage||t.selectedTab==="map",children:s(t.threshold)})}),e.jsxs(oe,{children:[e.jsx(le,{}),n.map(a=>e.jsx(ce,{onSelect:()=>r(l=>({...l,threshold:a.value})),children:a.label},a.value))]})]})})}function er({settings:t,setSettings:r}){const n=Object.keys(z).map(s=>({value:s,label:e.jsx(xe,{label:s})}));return e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(Y,{htmlFor:"linepicker",className:"text-sm font-medium",children:e.jsx(y,{children:"PITA.Subject.Line"})}),e.jsxs(se,{children:[e.jsx(ae,{asChild:!0,disabled:t.selectedTab==="map",children:e.jsx(I,{id:"linepicker",variant:"outline",children:e.jsx(xe,{label:t.line})})}),e.jsxs(oe,{children:[e.jsx(le,{}),e.jsx(wt,{children:"Line"}),e.jsx(yt,{}),n.map(s=>e.jsx(ce,{onSelect:()=>r(a=>({...a,line:s.value})),children:s.label},s.value))]})]})]})}function tr({settings:t,setSettings:r}){return e.jsxs("div",{className:"m-5 grid gap-4 md:grid-cols-1 lg:grid-cols-3",children:[e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(O,{children:e.jsx(y,{children:"PITA.Subject.Title"})})}),e.jsxs(U,{className:"space-y-2",children:[e.jsx(Xt,{settings:t,setSettings:r}),e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx("div",{className:"",children:e.jsx(er,{settings:t,setSettings:r})}),e.jsx("div",{className:"",children:e.jsx(Jt,{settings:t,setSettings:r})})]})]})]}),e.jsxs(F,{children:[e.jsxs(K,{children:[e.jsx(O,{children:e.jsx(y,{children:"PITA.Realtime.Title"})}),e.jsx(me,{children:e.jsx(y,{children:"PITA.Realtime.Description"})})]}),e.jsx(U,{children:e.jsx(Wt,{settings:t,setSettings:r})})]}),e.jsxs(F,{children:[e.jsxs(K,{children:[e.jsx(O,{children:e.jsx(y,{children:"PITA.Percentage.Title"})}),e.jsx(me,{children:e.jsx(y,{children:"PITA.Percentage.Description"})})]}),e.jsxs(U,{className:"flex w-full justify-between",children:[e.jsx(Zt,{settings:t,setSettings:r}),e.jsx(Qt,{settings:t,setSettings:r})]})]})]})}async function we(t,r,n){const s=gt({date:t,south:n.toString(),interval:r.interval.toString(),realtime:r.realtime?"1":"0",label:r.line,threshold:r.threshold.toString()});return await(await fetch(s)).json()}async function rr(t){const r=T(t.chartDate,"yyyy-MM-dd"),n=vt({date:r,interval:t.interval.toString(),realtime:t.realtime?"1":"0",threshold:t.threshold.toString()});return await(await fetch(n)).json()}function nr(){return e.jsx("div",{className:"m-5 flex h-1/2 items-center justify-center",children:e.jsxs(F,{className:"h-1/2 w-full",children:[e.jsx(K,{className:"flex flex-col items-center justify-center",children:e.jsxs(O,{className:"flex flex-col items-center justify-center text-center text-4xl",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx(Rt,{size:50,className:"text-center text-gray-200"}),e.jsx(St,{strokeWidth:.7,size:100,className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-red-200"})]}),e.jsx(y,{children:"PITA.NoDepartures.Title"})]})}),e.jsx(U,{className:"flex flex-col items-center justify-center",children:e.jsx("p",{className:"w-1/2 text-center text-muted-foreground",children:e.jsx(y,{children:"PITA.NoDepartures.Description"})})})]})})}var $e=["PageUp","PageDown"],He=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Ve={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},B="Slider",[te,sr,ar]=nt(B),[Fe,Lr]=Se(B,[ar]),[or,q]=Fe(B),Ke=u.forwardRef((t,r)=>{const{name:n,min:s=0,max:a=100,step:l=1,orientation:o="horizontal",disabled:c=!1,minStepsBetweenThumbs:h=0,defaultValue:i=[s],value:b,onValueChange:d=()=>{},onValueCommit:x=()=>{},inverted:j=!1,form:m,...p}=t,g=u.useRef(new Set),f=u.useRef(0),w=o==="horizontal"?lr:cr,[v=[],N]=ye({prop:b,defaultProp:i,onChange:S=>{var E;(E=[...g.current][f.current])==null||E.focus(),d(S)}}),X=u.useRef(v);function W(S){const M=fr(v,S);L(S,M)}function et(S){L(S,f.current)}function tt(){const S=X.current[f.current];v[f.current]!==S&&x(v)}function L(S,M,{commit:E}={commit:!1}){const ue=br(l),Z=jr(Math.round((S-s)/l)*l+s,ue),$=Ne(Z,[s,a]);N((A=[])=>{const R=ur(A,$,M);if(pr(R,h*l)){f.current=R.indexOf($);const he=String(R)!==String(A);return he&&E&&x(R),he?R:A}else return A})}return e.jsx(or,{scope:t.__scopeSlider,name:n,disabled:c,min:s,max:a,valueIndexToChangeRef:f,thumbs:g.current,values:v,orientation:o,form:m,children:e.jsx(te.Provider,{scope:t.__scopeSlider,children:e.jsx(te.Slot,{scope:t.__scopeSlider,children:e.jsx(w,{"aria-disabled":c,"data-disabled":c?"":void 0,...p,ref:r,onPointerDown:_(p.onPointerDown,()=>{c||(X.current=v)}),min:s,max:a,inverted:j,onSlideStart:c?void 0:W,onSlideMove:c?void 0:et,onSlideEnd:c?void 0:tt,onHomeKeyDown:()=>!c&&L(s,0,{commit:!0}),onEndKeyDown:()=>!c&&L(a,v.length-1,{commit:!0}),onStepKeyDown:({event:S,direction:M})=>{if(!c){const Z=$e.includes(S.key)||S.shiftKey&&He.includes(S.key)?10:1,$=f.current,A=v[$],R=l*Z*M;L(A+R,$,{commit:!0})}}})})})})});Ke.displayName=B;var[Oe,Ue]=Fe(B,{startEdge:"left",endEdge:"right",size:"width",direction:1}),lr=u.forwardRef((t,r)=>{const{min:n,max:s,dir:a,inverted:l,onSlideStart:o,onSlideMove:c,onSlideEnd:h,onStepKeyDown:i,...b}=t,[d,x]=u.useState(null),j=P(r,w=>x(w)),m=u.useRef(void 0),p=st(a),g=p==="ltr",f=g&&!l||!g&&l;function k(w){const v=m.current||d.getBoundingClientRect(),N=[0,v.width],W=de(N,f?[n,s]:[s,n]);return m.current=v,W(w-v.left)}return e.jsx(Oe,{scope:t.__scopeSlider,startEdge:f?"left":"right",endEdge:f?"right":"left",direction:f?1:-1,size:"width",children:e.jsx(ze,{dir:p,"data-orientation":"horizontal",...b,ref:j,style:{...b.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:w=>{const v=k(w.clientX);o==null||o(v)},onSlideMove:w=>{const v=k(w.clientX);c==null||c(v)},onSlideEnd:()=>{m.current=void 0,h==null||h()},onStepKeyDown:w=>{const N=Ve[f?"from-left":"from-right"].includes(w.key);i==null||i({event:w,direction:N?-1:1})}})})}),cr=u.forwardRef((t,r)=>{const{min:n,max:s,inverted:a,onSlideStart:l,onSlideMove:o,onSlideEnd:c,onStepKeyDown:h,...i}=t,b=u.useRef(null),d=P(r,b),x=u.useRef(void 0),j=!a;function m(p){const g=x.current||b.current.getBoundingClientRect(),f=[0,g.height],w=de(f,j?[s,n]:[n,s]);return x.current=g,w(p-g.top)}return e.jsx(Oe,{scope:t.__scopeSlider,startEdge:j?"bottom":"top",endEdge:j?"top":"bottom",size:"height",direction:j?1:-1,children:e.jsx(ze,{"data-orientation":"vertical",...i,ref:d,style:{...i.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:p=>{const g=m(p.clientY);l==null||l(g)},onSlideMove:p=>{const g=m(p.clientY);o==null||o(g)},onSlideEnd:()=>{x.current=void 0,c==null||c()},onStepKeyDown:p=>{const f=Ve[j?"from-bottom":"from-top"].includes(p.key);h==null||h({event:p,direction:f?-1:1})}})})}),ze=u.forwardRef((t,r)=>{const{__scopeSlider:n,onSlideStart:s,onSlideMove:a,onSlideEnd:l,onHomeKeyDown:o,onEndKeyDown:c,onStepKeyDown:h,...i}=t,b=q(B,n);return e.jsx(C.span,{...i,ref:r,onKeyDown:_(t.onKeyDown,d=>{d.key==="Home"?(o(d),d.preventDefault()):d.key==="End"?(c(d),d.preventDefault()):$e.concat(He).includes(d.key)&&(h(d),d.preventDefault())}),onPointerDown:_(t.onPointerDown,d=>{const x=d.target;x.setPointerCapture(d.pointerId),d.preventDefault(),b.thumbs.has(x)?x.focus():s(d)}),onPointerMove:_(t.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&a(d)}),onPointerUp:_(t.onPointerUp,d=>{const x=d.target;x.hasPointerCapture(d.pointerId)&&(x.releasePointerCapture(d.pointerId),l(d))})})}),Ye="SliderTrack",Ge=u.forwardRef((t,r)=>{const{__scopeSlider:n,...s}=t,a=q(Ye,n);return e.jsx(C.span,{"data-disabled":a.disabled?"":void 0,"data-orientation":a.orientation,...s,ref:r})});Ge.displayName=Ye;var re="SliderRange",qe=u.forwardRef((t,r)=>{const{__scopeSlider:n,...s}=t,a=q(re,n),l=Ue(re,n),o=u.useRef(null),c=P(r,o),h=a.values.length,i=a.values.map(x=>Ze(x,a.min,a.max)),b=h>1?Math.min(...i):0,d=100-Math.max(...i);return e.jsx(C.span,{"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,...s,ref:c,style:{...t.style,[l.startEdge]:b+"%",[l.endEdge]:d+"%"}})});qe.displayName=re;var ne="SliderThumb",Xe=u.forwardRef((t,r)=>{const n=sr(t.__scopeSlider),[s,a]=u.useState(null),l=P(r,c=>a(c)),o=u.useMemo(()=>s?n().findIndex(c=>c.ref.current===s):-1,[n,s]);return e.jsx(ir,{...t,ref:l,index:o})}),ir=u.forwardRef((t,r)=>{const{__scopeSlider:n,index:s,name:a,...l}=t,o=q(ne,n),c=Ue(ne,n),[h,i]=u.useState(null),b=P(r,k=>i(k)),d=h?o.form||!!h.closest("form"):!0,x=De(h),j=o.values[s],m=j===void 0?0:Ze(j,o.min,o.max),p=hr(s,o.values.length),g=x==null?void 0:x[c.size],f=g?mr(g,m,c.direction):0;return u.useEffect(()=>{if(h)return o.thumbs.add(h),()=>{o.thumbs.delete(h)}},[h,o.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[c.startEdge]:`calc(${m}% + ${f}px)`},children:[e.jsx(te.ItemSlot,{scope:t.__scopeSlider,children:e.jsx(C.span,{role:"slider","aria-label":t["aria-label"]||p,"aria-valuemin":o.min,"aria-valuenow":j,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...l,ref:b,style:j===void 0?{display:"none"}:t.style,onFocus:_(t.onFocus,()=>{o.valueIndexToChangeRef.current=s})})}),d&&e.jsx(We,{name:a??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:j},s)]})});Xe.displayName=ne;var dr="RadioBubbleInput",We=u.forwardRef(({__scopeSlider:t,value:r,...n},s)=>{const a=u.useRef(null),l=P(a,s),o=ke(r);return u.useEffect(()=>{const c=a.current;if(!c)return;const h=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(h,"value").set;if(o!==r&&b){const d=new Event("input",{bubbles:!0});b.call(c,r),c.dispatchEvent(d)}},[o,r]),e.jsx(C.input,{style:{display:"none"},...n,ref:l,defaultValue:r})});We.displayName=dr;function ur(t=[],r,n){const s=[...t];return s[n]=r,s.sort((a,l)=>a-l)}function Ze(t,r,n){const l=100/(n-r)*(t-r);return Ne(l,[0,100])}function hr(t,r){return r>2?`Value ${t+1} of ${r}`:r===2?["Minimum","Maximum"][t]:void 0}function fr(t,r){if(t.length===1)return 0;const n=t.map(a=>Math.abs(a-r)),s=Math.min(...n);return n.indexOf(s)}function mr(t,r,n){const s=t/2,l=de([0,50],[0,s]);return(s-l(r)*n)*n}function xr(t){return t.slice(0,-1).map((r,n)=>t[n+1]-r)}function pr(t,r){if(r>0){const n=xr(t);return Math.min(...n)>=r}return!0}function de(t,r){return n=>{if(t[0]===t[1]||r[0]===r[1])return r[0];const s=(r[1]-r[0])/(t[1]-t[0]);return r[0]+s*(n-t[0])}}function br(t){return(String(t).split(".")[1]||"").length}function jr(t,r){const n=Math.pow(10,r);return Math.round(t*n)/n}var Je=Ke,gr=Ge,vr=qe,wr=Xe;const Qe=u.forwardRef(({className:t,...r},n)=>e.jsxs(Je,{ref:n,className:D("relative flex w-full touch-none select-none items-center",t),...r,children:[e.jsx(gr,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(vr,{className:"absolute h-full bg-primary"})}),e.jsx(wr,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));Qe.displayName=Je.displayName;function yr(t,r){const n=r.getTime();return t.find(s=>new Date(s.bucket.replace(" ","T")).getTime()===n)}function Sr(t,r,n,s){const a={};return t.forEach(l=>{const o=yr(l.buckets,r);if(!o)return;const c=parseFloat(o.avgDelay);a[l.station]={departures:[],avgDelay:c,friendlyName:n[l.station]||l.name||"Unknown Station",coordinates:l.coordinates,lastUpdated:s.chartDate}}),a}const Dr=({stations:t,settings:r,setSettings:n})=>{const{chartDate:s,interval:a,selectedBucketDate:l}=r,o=J(s),h=Math.floor(1440/a);u.useEffect(()=>{n(m=>{const p=m.selectedBucketDate,g=(p.getTime()-J(p).getTime())/6e4;return{...m,selectedBucketDate:Q(J(m.chartDate),g)}})},[s,n]);const i=Math.floor((l.getTime()-o.getTime())/(a*6e4)),[b,d]=u.useState(i);u.useEffect(()=>{const m=Math.floor((l.getTime()-o.getTime())/(a*6e4));d(m)},[l,o,a]);const x=m=>{const p=m[0];d(p);const g=Q(o,p*a);n(f=>({...f,selectedBucketDate:g}))},j=Sr(t,l,ht,r);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"mx-5",children:[e.jsxs("p",{className:"my-2 font-semibold",children:["Selected Time:"," ",T(Q(o,b*a),"HH:mm")]}),e.jsx(Qe,{value:[b],min:0,max:h-1,step:1,onValueChange:x})]}),e.jsx("div",{className:"mt-4",children:e.jsx(Dt,{stations:j,historyMode:!0})})]})};function kr({stationId:t,chartDateFormatted:r,settings:n,southChartData:s,northChartData:a}){const l=s.find(c=>c.station===t),o=a.find(c=>c.station===t);return!l&&!o?null:e.jsxs("tr",{children:[e.jsx("td",{className:"border-y",children:l?e.jsx(ve,{stationData:l,day:r,interval:n.interval,yAxisOrientation:"left",showPercentage:n.showPercentage,threshold:n.threshold}):e.jsx("div",{className:"text-center text-sm",children:"No data"})}),e.jsx("td",{className:"border text-center",children:e.jsx("div",{className:"mx-5",children:z[n.line][t]??"Unknown Station"})}),e.jsx("td",{className:"border-y",children:o?e.jsx(ve,{stationData:o,day:r,interval:n.interval,yAxisOrientation:"right",showPercentage:n.showPercentage,threshold:n.threshold}):e.jsx("div",{className:"text-center text-sm",children:"No data"})})]},t)}function $r(){const[t,r]=u.useState([]),[n,s]=u.useState([]),[a,l]=u.useState([]),[o,c]=Tt(),h=()=>({chartDate:o.get("d")?new Date(o.get("d")):new Date(2024,1,17),interval:o.get("i")?Number(o.get("i")):20,realtime:o.get("r")?o.get("r")==="1":!0,line:o.get("l")??"U6",threshold:o.get("t")?Number(o.get("t")):0,showPercentage:o.get("p")?o.get("p")==="1":!1,selectedTab:o.get("s")||"table",selectedBucketDate:o.get("b")?new Date(`${o.get("d")}T${o.get("b")}`):new Date(2024,1,17)}),[i,b]=u.useState(h());u.useEffect(()=>{c({d:T(i.chartDate,"yyyy-MM-dd"),i:i.interval.toString(),r:i.realtime?"1":"0",l:i.line,t:i.threshold.toString(),p:i.showPercentage?"1":"0",s:i.selectedTab,b:T(i.selectedBucketDate,"HH:mm")})},[i,c]),Ct();const d=T(i.chartDate,"yyyy-MM-dd");u.useEffect(()=>{async function j(){try{const m=[];i.selectedTab==="table"?(m.push(we(d,i,1)),m.push(we(d,i,0))):i.selectedTab==="map"&&m.push(rr(i));const p=await Promise.all(m);i.selectedTab==="table"?(r(p[0]),s(p[1])):i.selectedTab==="map"&&l(p[0])}catch(m){console.error("Error fetching chart data:",m)}}j()},[d,i]);let x=[];return t&&n&&(x=Object.keys(z[i.line]).filter(j=>{const m=t.some(g=>g.station===j),p=n.some(g=>g.station===j);return m||p})),e.jsxs("div",{className:"container mx-auto",children:[e.jsx(tr,{settings:i,setSettings:b}),e.jsx("div",{className:"mt-5",children:e.jsxs(kt,{defaultValue:"table",value:i.selectedTab,onValueChange:j=>b(m=>({...m,selectedTab:j})),children:[e.jsxs(Nt,{className:"mx-5 grid grid-cols-2",children:[e.jsx(pe,{value:"table",children:e.jsx(y,{children:"Tabs.Table"})}),e.jsx(pe,{value:"map",children:e.jsx(y,{children:"Tabs.Map"})})]}),e.jsx(be,{value:"table",children:x.length>0?e.jsxs("table",{className:"w-full table-auto border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-1/2",children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx(je,{}),e.jsx(y,{children:"Table.Columns.Southbound"}),e.jsx(je,{})]})}),e.jsx("th",{className:"w-auto whitespace-nowrap",children:"Station"}),e.jsx("th",{className:"w-1/2",children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx(ge,{}),e.jsx(y,{children:"Table.Columns.Northbound"}),e.jsx(ge,{})]})})]})}),e.jsx("tbody",{children:Object.keys(z[i.line]).map(j=>e.jsx(kr,{stationId:j,chartDateFormatted:d,settings:i,southChartData:t,northChartData:n},j))})]}):e.jsx(nr,{})}),e.jsx(be,{value:"map",children:e.jsx(Dr,{stations:a,settings:i,setSettings:b})})]})})]})}export{$r as default};
